# Install necessary system-level packages
packages:
  yum:
    gcc: []
    libffi-devel: []
    openssl-devel: []
    python3-devel: []
    postgresql-devel: []  # Add this if using PostgreSQL; otherwise, remove it

# Install dependencies and prepare the environment
container_commands:
  01_collectstatic:
    command: "python3 manage.py collectstatic --noinput"
    leader_only: true

  02_migrate:
    command: "python3 manage.py migrate --noinput"
    leader_only: true

# Environment variable configuration
option_settings:
  aws:elasticbeanstalk:application:environment:
    DJANGO_SETTINGS_MODULE: "todo_project.settings"
    PYTHONPATH: "/var/app/current"
  aws:elasticbeanstalk:container:python:
    WSGIPath: "todo_project.wsgi:application"

# Static files configuration (if using Elastic Beanstalk's proxy to serve them)
files:
  "/etc/httpd/conf.d/static_files.conf":
    mode: "000644"
    owner: "root"
    group: "root"
    content: |
      Alias /static/ /var/app/current/staticfiles/
      <Directory /var/app/current/staticfiles>
          Require all granted
      </Directory>

# Commands to restart the server and ensure everything is set up properly
commands:
  enable-https:
    command: "sed -i 's/#.*ServerSignature.*On/ServerSignature Off/' /etc/httpd/conf/httpd.conf"
